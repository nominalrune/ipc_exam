
## 問2 ドメイン名変更に関する次の記述を読んで、設問に答えよ。

A社は、従業員 1,000名の工作機械製造会社である。A社の技術力は高く評価されている。A社には、総務部、営業部、情報システム部、技術部及び製造部がある。A社のWebサイトでは、一般向けにIR情報と関連会社へのリンクを、顧客向けに自社製の工作機械管理用アプリケーションプログラムとそのソフトウェア修正プログラムを提供している。また、A社では、電子メール(以下、メールという)を用いて、顧客との間で見積書や注文書の送受信をしたり、ニュースサイトのメールマガジンに登録して最新の情報を収集したりしている。

A社のドメイン名を詐称したメールが毎週2通程度、送られていることが、多くの顧客から報告されている。情報システム部長は、顧客に詐欺などの被害が生じるおそれがあることを認識し、メールの詐称対策が必要であると考えている。

### 〔情報システムの現状〕

A社は、10年前にドメイン名 `a-sha.co.jp`(以下、A社ドメイン名という)を取得して以降、A社の Web サイト(以下, A-Web サイトという) 及びメールアドレスのドメイン名として利用している。A社ドメイン名は、DNS サービス事業者であるS社の権威 DNS サービス(以下、Sサービスという)を用いて管理している。

A-Web サイトは、Webサービス事業者であるW社のWebサービス (以下, Wサービスという)を用いて提供している。

A社のネットワークを図1に、構成要素の機能を表1に示す。A社の従業員は、PC-LAN 内の PC で業務を行っている。

**図1 A社のネットワーク (抜粋)**
*注記 PC-LAN内のPCの記載は省略している。*

```mermaid
graph TD
    subgraph Internet Space
        W_Service[Wサービス]
        Internet[インターネット]
        subgraph DNS_Services
            Cache_DNS[キャッシュDNSサービス]
            S_Service[Sサービス]
        end
    end

    subgraph A社
        Firewall[ファイアウォール]
        subgraph DMZ
            Mail_Server[メールサーバ]
        end
        subgraph Server_LAN
            L2Switch[レイヤー2スイッチ]
            App_Server[業務サーバ]
            L2Switch --> App_Server
        end
        PC_LAN
        Mail_Server --> Firewall
        Firewall -- to/from -- PC_LAN
        Firewall -- to/from -- L2Switch
    end

    Internet -- to/from -- W_Service
    Internet -- to/from -- DNS_Services
    Internet -- to/from -- Firewall
```

**表1 構成要素の機能(抜粋)**
| 構成要素 | 機能 |
| :--- | :--- |
| メールサーバ | ・S社が提供するキャッシュ DNS サービスを用いて、DNS 問合せを行う。<br>・インターネットとの間で、SMTP を用いてメールを転送する。<br>・PC-LAN 及び業務サーバからSMTP を用いて送信されるメールを受信する。<br>・宛先メールアドレスのドメイン名が <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">a</span> であるメールをメールボックスに格納する。<br>・第三者中継防止のためのルールを用いて、第三者中継を防止する。第三者中継防止のためのルールを表2に示す。<br>・メールボックス内のメールを、PC-LAN内のPCがPOP3を用いて受信できるようにする。 |

**表2 第三者中継防止のためのルール**
*注記 項番が小さいルールから順に、最初に一致したルールが適用される。*
| 項番 | 転送元 | 宛先メールアドレスのドメイン名 | 転送処理 |
| :--- | :--- | :--- | :--- |
| 1 | インターネット | <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">a</span> | 許可 |
| 2 | PC-LAN | <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">b</span> | 許可 |
| 3 | 業務サーバ | A社ドメイン名 | 許可 |
| 4 | 全て | 全て | 拒否 |

### 〔ドメイン名の変更についての検討〕

A社は、3か月後にZ社への社名変更を予定している。情報システム部長は、メールの詐称対策の導入及び社名変更に合わせたドメイン名変更を検討するように情報システム部のN主任に指示した。N主任は情報システム部のEさんと、次のとおり検討した。

  - `z-sha.co.jp`(以下、Z社ドメイン名という)が過去に取得されたことがないドメイン名であることを確認してから取得する。
  - Z社ドメイン名の管理もSサービスで行う。
  - WサービスでZ社ドメイン名の Web サイト(以下, Z-Web サイトという) も立ち上げる。
  - 図1のメールサーバでは、複数のドメイン名のメールを受信できないことから、商用のメールサービスに移行する。
  - メールの詐称対策は、SPF, DKIM 及びDMARCで対応する。

N主任とEさんは、Z社が送信するメールの詐称対策(以下,送信対応という)と、Z 社が受信するメールの詐称対策(以下,受信対応という)について方針をそれぞれ表3と表4のとおり作成した。

**表3 送信対応方針**
| 項番 | 対応方針概要 |
| :--- | :--- |
| 1 | 送信するメールのエンベロープ From 及びヘッダーFromのドメイン名をZ社ドメイン名とする。 |
| 2 | Z社ドメイン名のメールを受信した側でSPF による認証及びDKIMによる認証に失敗した場合のアクションをDMARC ポリシーとして定義する。 |
| 3 | DMARC ポリシーレコード(以下、DMARC レコードという), SPF レコード及び DKIM キーレコード(以下, DKIM レコードという)をSサービスに登録する。 |
| 4 | 送信するメールには、DKIM 署名を付与する |
| 5 | DMARC レポートを分析する。 |
| 6 | 顧客に、Z社は送信するメールについて、SPF, DKIM 及び DMARC に対応済みであることを周知する。 |

**表4 受信対応方針**
| 項番 | 対応方針概要 |
| :--- | :--- |
| 1 | 受信するメールの宛先メールアドレスのドメイン名は、Z社ドメイン名とする |
| 2 | 顧客に、送信するメールについてSPF, DKIM 及びDMARC に対応するように依頼する |
| 3 | SPF による認証及びDKIMによる認証を行いそのいずれかが成功した場合、DMARCの認証が成功したものと判断し、受信する。 |
| 4 | 送信元のDMARC ポリシーに基づき、メールの受信、隔離又は拒否を行う |

N主任とEさんは、これまでの結果を、情報システム部長に報告し、了承を得た。

### 〔メールサービスの機能の検討〕

N主任とEさんは、メールサービスの機能について検討し、メールサービス事業者である U社のメールサービス(以下, Uサービスという)に移行することにした。Uサービスの機能の概要を表5に示す。

**表5 Uサービスの機能の概要(抜粋)**
| 機能 | 概要 |
| :--- | :--- |
| メール転送 | ・インターネットとの間は、SMTPをTLS で暗号化する <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">c</span> を使用してメールを転送することができる。 |
| Webメール | ・Web ブラウザを用いてメールを送受信する。 |
| Uサービス管理 Web | ・利用者アカウントの登録や削除を行う。<br>・送信したメールについて DMARC レポートの分析結果を参照することができる。 |

### 〔Z-Web サイト及びUサービスへの移行手順の検討〕

Eさんは、Z-Web サイト及びUサービスへの移行手順を検討した。検討結果を、図2及び図3にそれぞれ示す。

**図2 Z-Web サイトへの移行手順**

  - **Web-Step1:** A-Web サイトのコンテンツを全て、Z-Web サイトに同一構成で配置する。Z-Web サイトに配置したコンテンツ中のA社ドメイン名をZ社ドメイン名に書き換える。
  - **Web-Step2:** 次を1年間、実施する。
      - A-Web サイトへのアクセスを、Z-Web サイトのトップページにリダイレクトする。
  - **Web-Step3:** A-Web サイトを停止する。A-Webサイト用のDNSレコードは削除する。

**図3 Uサービスへの移行手順**

  - **Mail-Step1:** 試行期間として次を1か月間、実施する。
      - 総務部及び情報システム部のメンバーだけが、Z社ドメイン名のメールアドレスを使用する。
      - 送信対応では、DMARC ポリシーを、特定のアクションを要求しないこととし、メールを受信してもらう。
      - 受信対応では、DMARCの認証結果にかかわらず受信する。
  - **Mail-Step2:** 図1のメールサーバの利用をやめ、次を3か月間、実施する。
      - Z社全体が、Uサービスを用いてZ社ドメイン名のメールアドレスを使用する。
      - Z社ドメイン名でのメールの利用を顧客に文書で周知するとともに、 Z-Web サイトで周知する。
      - A社ドメイン名宛てのメールをUサービスで受信する。
  - **Mail-Step3:** 送信対応のDMARC ポリシーを隔離に変更し、その6か月後、拒否に変更する。
  - **Mail-Step4:** A社ドメイン名でのメールの受信を停止する。メールサーバ用のDNS レコードは削除する。
  - **Mail-Step5:** 問題がないと確認できたら、受信対応でDMARCの処理を行う。

Eさんは、図2及び図3をN主任に説明し、了承を得た。

### 〔送信対応の設定内容についての検討〕

Eさんは、送信対応に用いる SPF レコードを、Uサービスから提供された情報に基づいて作成した。
次に、Eさんは、送信対応に用いる DKIM レコードについて検討した。Z社がUサービスを利用した場合、送信されるメールに付与される DKIM-Signature ヘッダーのタグの内容を表6に示す。

**表6 タグの内容(抜粋)**
| タグ | 内容 |
| :--- | :--- |
| v | 1 |
| a | rsa-sha256 |
| d | z-sha.co.jp |
| h | From:To:Subject:Date:Message-ID:MIME-Version |
| s | z2024 |

表6から、①<u>DKIM レコードの名称として使用するFQDNが決まる</u>。Eさんは、Uサービスから提供された情報に基づき DKIM レコードを作成した。
最後に、Eさんは、Mail-Step1 の送信対応ではDMARC レコードを図4のとおりとすることにした。

**図4 DMARC レコード**

```
v=DMARC1; p=<d>; rua=mailto:rua-report@z-sha.co.jp
```

Eさんは、設定内容をまとめてN主任に報告し、了承を得た。

### [A社ドメイン名の契約についての検討]

N主任とEさんは、A社ドメイン名使用の契約を継続するか解約するかについて検討した。解約した場合、第三者がA社ドメイン名を取得することができる。N主任とEさんは、第三者がA社ドメイン名を取得した場合のA社ドメイン名の悪用例を検討し、表7のとおりまとめた。

**表7 A社ドメイン名の悪用例**
| 項目 | 悪用の例 |
| :--- | :--- |
| Web の悪用 | 第三者が、A社ドメイン名を用いて、現在のA-Web サイトと見た目が同じWeb サイトを立ち上げるという悪用が考えられる。さらに、第三者が、コンテンツを細工してWebサイトの見た目を変えずに②<u>顧客に影響を及ぼす攻撃をする</u>ことが考えられる。 |
| メールの送信 | 第三者が、メールサーバを立ち上げ、A社ドメイン名のメールアドレスを送信元メールアドレスとしてメールを送信するという悪用が考えられる。 |
| メールの受信 | 従業員が業務で用いる社外サービスがあり、メールでの連絡先として、A社ドメイン名のメールアドレスを登録していたとする。もし連絡先の変更を忘れてしまうと、③<u>第三者が、社外サービスからA社ドメイン名のメールアドレスへのメールを受信し、そのメールを使って続きの攻撃を行う</u>という悪用が考えられる。 |

N主任とEさんは、A社ドメイン名使用の契約を継続することを情報システム部長に報告し、承認を得た。
また、A社ドメイン名については、Mail-Step4 の後で次のとおり、設定することにした。

  - DMARC レコードを設定する。
  - DMARC の受信対応を行った組織がA社ドメイン名からのメールを拒否できるようにする。
    そのために、A社ドメイン名について、SPF レコードを図5のように設定する。DKIM レコードは設定しない。

**図5 SPF レコード**

```
v=spf1 <e>
```

### 〔Uサービスへの移行の見直し〕

Mail-Step1 において、DMARC レポートの分析結果を参照した結果、送信対応には問題がないことが確認できた。
Mail-Step2 の開始1週間後、情報システム部のEさんに営業部のHさんから、図6に示すメールの一斉配信をしても問題ないか相談があった。

**図6 メールの一斉配信の説明**

1.  定期的に、Z社の公式情報の周知のためのメールを一斉配信する。
2.  宛先には、社内と社外のメールアドレスが含まれている。
3.  一斉配信には、T社のサービス(以下、Tサービスという)を利用する計画であり、Tサービスの仕様は次のとおりである。
      - **配信方法**
          - 宛先メールアドレスは、サービス契約者が登録できる。
          - 宛先メールアドレスごとに個別に送信する。
      - **メールのヘッダーの設定**
          - From は、サービス契約者が所属する組織が保有するドメイン名を用いたメールアドレスだけを設定できる。
          - Toは、宛先のメールアドレスから一つずつ、Tサービスが設定する。
          - Subject は、一斉配信の都度、サービス契約者が設定する。
          - 他のヘッダーは、Tサービスが設定する。

Eさんから相談を受けたN主任は、図6の一斉配信メールについて、次のとおり Eさんに説明した。

  - Mail-Step3 以降で、一斉配信されたメールが届かない場合がある。メールが届くように、Mail-Step2の期間で、④<u>表3の項番3での登録内容を見直す必要がある</u>。

Eさんは、見直し案を作成し、N主任の了承を得てから、Hさんに問題ないことを説明した。
Mail-Step2 の開始2週間後、情報システム部に技術部のJさんから、図7に示すメーリングリストを新たに利用することが可能か相談があった。

**図7 メーリングリストの説明**
*注) メールが転送される場合でも、メールの認証結果を確認できるようにする仕組みとして、RFC 8617に定義されている。*

1.  使用するメーリングリストは一つである。
2.  メーリングリストの管理者は、Z社従業員である。
3.  製品に関する情報交換のために、メーリングリストを使用する。
4.  メーリングリストの配信先となる宛先には、社内及び社外のメールアドレスを登録する(以下、登録されたメールアドレスを登録メンバーという)。
5.  登録メンバーから、メーリングリスト宛てにメールを送信できる。
6.  メールサービス事業者である Y社のサービス(以下、Yサービスという)を利用する計画であり、Yサービスの仕様は次のとおりである。
    1.  メーリングリストのメールアドレスは、サービス契約者ごとに割り当てられたY サービスのメールアドレスである。ドメイン名はY社のドメイン名である。
    2.  Yサービスの管理画面で設定できる項目は (3)~(6)であり、配信されるメールに反映される。
    3.  **エンベロープ From の設定**
          - メーリングリストの管理者のメールアドレスを設定する。
    4.  **ヘッダーFrom の設定**
          - 次のいずれかを選択する。
              - **ヘッダーFrom 設定1:** メーリングリスト宛てに送信されたメールのヘッダーFrom を使用する。
              - **ヘッダーFrom 設定2:** メーリングリストのメールアドレスを使用する。
    5.  **Subject の設定**
          - 次のいずれかを選択する。
              - **Subject 設定1:** メーリングリスト宛てに送信されたメールのSubject を使用する。
              - **Subject 設定2:** メーリングリスト宛てに送信されたメールのSubject にメールの通番情報を付加する。
    6.  **Reply-To の設定**
          - メーリングリストのメールアドレスを設定する。
    7.  **ヘッダーFrom, Subject 及び Reply-To 以外のヘッダー**
          - メーリングリスト宛てに送信したメールのヘッダーを引き継ぐ。
    8.  **Authenticated Received Chain (ARC) について**
          - ARCには、対応していない。

N主任は、Eさんに図8に示すとおり説明した。

**図8 N主任の説明**

  - Mail-Step3 以降にZ社の従業員が送信したメールについて
      - ヘッダーFrom 設定1とSubject 設定1の組合せでは、不達の問題は起きない。
      - ヘッダーFrom 設定1と Subject 設定2の組合せでは、⑤<u>SPF による認証及びDKIMによる認証の両方に失敗することによって不達の問題が発生することがある</u>。
      - ヘッダーFrom 設定2については、Z社の従業員が送信したメールであるかどうかの判定ができないので、用いるべきではない。
  - Mail-Step3 以降にZ社の従業員以外が送信したメールについて
      - (省略)

N主任とEさんは、Jさんには、ヘッダーFrom 設定1と Subject 設定1の組合せを用いるよう説明した。
その後、Z-Web サイト及びUサービスへの移行は、順調に進み、完了した。

-----

### 設問1

〔情報システムの現状〕 について答えよ。
(1) 表1中及び表2中の <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">a</span> に入れる適切な字句を答えよ。
(2) 表2中の <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">b</span> に入れる適切な字句を答えよ。

### 設問2

表5中の <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">c</span> に入れる適切な字句を英字10字以内で答えよ。

### 設問3

[送信対応の設定内容についての検討] について答えよ。
(1) 本文中の下線①のFQDNを解答群の中から選び、記号で答えよ。
**解答群**
ア `rsa-sha256._dkim.z-sha.co.jp`
イ `rsa-sha256._domainkey.z-sha.co.jp`
ウ `z2024._dkim.z-sha.co.jp`
エ `z2024._domainkey.z-sha.co.jp`
オ `z2024.z-sha.co.jp`
(2) 図4中の <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">d</span> に入れる適切な字句を解答群の中から選び、記号で答えよ。
**解答群**
ア accept
イ none
ウ quarantine
エ receive
オ reject

### 設問4

〔A社ドメイン名の契約についての検討〕 について答えよ。
(1) 表7中の下線②について、攻撃の方法を具体的に答えよ。
(2) 表7中の下線③について、受信するメールの内容及び続きの攻撃の例を具体的に答えよ。
(3) 図5中の <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">e</span> に入れる適切な字句を解答群の中から選び、記号で答えよ。
**解答群**
ア -all
イ ?all
ウ block
エ deny
オ refuse

### 設問5

[Uサービスへの移行の見直し】 について答えよ。
(1) 本文中の下線④について、見直しの内容を具体的に答えよ。
(2) 図8中の下線⑤について、SPF による認証に失敗する理由及びDKIM による認証に失敗する理由をそれぞれ、Sサービスへの登録内容とサービスの仕様を含めて、具体的に答えよ。

-----
