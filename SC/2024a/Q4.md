
## 問4 セキュリティ診断に関する次の記述を読んで、設問に答えよ。

B社は、セキュリティ診断サービスを提供している会社である。このたび、転職支援サービスを提供しているM社から、転職支援 Web サイト(以下、Mサイトという)のセキュリティ診断を受注した。

M サイトを利用する求職者は、氏名、自宅住所,電話番号,勤務先などの求職者属性情報と、希望職種,希望条件などの求職情報を入力する。求人企業は、会社情報,求人情報,求人担当者の氏名、所属部署などの情報を入力する。これらの情報は、Mサイトのデータベースに保存される。Mサイトでは、入力された情報に基づいて、求職者と求人企業のマッチングを行っている。求職者は、マッチングで提案された企業に問合せや応募をすることができる。

Mサイトは、機能を追加した新しいバージョンの Web アプリケーションプログラム(以下、MサイトのWeb アプリケーションプログラムをWeb アプリという)と、求人企業がアプリケーションプログラムから HTTPSで呼び出すことを想定したインタフェース(以下、このインタフェースを WebAPI という)の開発が完了したところであり、リリース前である。

### 〔セキュリティ診断の診断対象と診断方法〕

今回のセキュリティ診断の診断対象と診断方法は、図1のとおりである。

**図1 診断対象と診断方法**

  - **【診断対象】**
      - Mサイトには本番用サイトと検証用サイトがあり、診断対象は M サイトの検証用サイトとする。検証用サイトには、開発が完了した新しいバージョンのWebアプリが導入されている。なお、本番用サイトと検証用サイトは、同一の構成である。
      - 検証用サイトでは、アクセス元の IP アドレスを制限している。診断に当たり、B社からも検証用サイトにアクセスできるように、検証用サイトの設定を変更する。
      - 検証用サイトには、テスト用疑似データが投入されている。
  - **【診断方法】**
      - B社の社内にある診断用 PCからインターネットを経由して診断を行う。
      - Webアプリの脆弱性の検出と、Web サーバのプラットフォームの脆弱性の検出を行う。
      - Web アプリの脆弱性の検出は、診断ツールと診断員の手作業で行う。
      - Webサーバのプラットフォームの脆弱性の検出は、診断ツールで行う。
      - 診断に当たり、必要に応じてMサイトの設計書を参照する。

Mサイトの設計書の中で参照した部分を、図2,図3及び表1に示す。

**図2 WebAPI の仕様**
*注1) 求職者がMサイトに利用者登録をした年月日の8桁の数字の後ろに、日ごとに000001 から登録順に割り当てられる6桁の数字を加えた数字14桁の文字列である。*
*注2) Mサイトを利用する求職者及び求人企業の担当者ごとに発行される。*

1.  プロトコルは、HTTPSとする。
2.  RESTful API によって、次の機能を求人企業に提供する。
    1.  日時の範囲を指定して、当該企業宛てに問合せがあった求職者の求職者ID<sup>1)</sup>を取得する。
    2.  日時の範囲を指定して、当該企業宛てに応募があった求職者の求職者IDを取得する。
    3.  任意の求職者 ID を指定して、求職者属性情報を取得する。
3.  求人企業の認証方式は次のとおりとする。
    1.  WebAPIを利用する際の利用者認証のために、Mサイトの利用者 ID<sup>2)</sup>と紐付けられた APIkeyを発行する。APIkey の有効期間は、発行後14日間とする。
    2.  WebAPI を利用する際の HTTP Request 内の APIkeyが、発行済みのものであり、かつ、有効期間内であるか確認することで、正規利用者であるかどうかを確認する。
4.  APIkey については、次のとおりとする。
    1.  求人企業のうち、WebAPI の利用契約を締結済みの企業だけに APIkey を発行する。利用契約で認めている求職者属性情報の利用範囲は、当該企業への問合せ又は当該企業への応募それぞれに関する対応だけである。
    2.  一つの利用者IDに対して複数のAPIkey を発行できる。
    3.  求職者には、APIkey を発行しない。

**図3 画面遷移図(抜粋)**
変換不可のため省略

**表1 各画面のURL**
*注) xは、PW再設定を行う都度生成されるランダムな英数字32字の文字列である。*
| 画面番号 | URL |
| :--- | :--- |
| 01, 02 | `https://test.△△△.jp/` |
| 03 | `https://test.△△△.jp/mypage` |
| 04, 05, 06 | `https://test.△△△.jp/apikey`, `https://test.△△△.jp/keylist` |
| 07, 08 | `https://test.△△△.jp/keynew` |
| 09, 10, 11 | `https://test.△△△.jp/property` |
| 12, 13 | `https://test.△△△.jp/pwchange` |
| 14, 15 | `https://test.△△△.jp/pwreset` |
| 16, 17 | `https://test.△△△.jp/pwreset/x` |

### 〔セキュリティ診断報告書〕

B社は、セキュリティ診断を実施し、図4の診断報告書を作成した。

**図4 診断報告書**
**1章 診断結果概要**
**1.1 診断結果要約**
Mサイトで、脆弱性を検出した。
(省略)
**1.2 検出した脆弱性の件数**
(省略)

**2章 Web アプリケーションプログラムの診断結果**
**2.1 検出した脆弱性の概要**
検出した脆弱性は、表Aのとおりである。

**表A 検出したWebアプリケーションプログラムの脆弱性の一覧**
| 項番 | 重要度 | 脆弱性の種類 | 検出箇所 |
| :--- | :--- | :--- | :--- |
| 1 | (省略) | セッションフィクセーション | 画面遷移 <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">a</span> |
| 2 | (省略) | メールヘッダーインジェクション | メール(あ)の送信 |
| 3 | (省略) | HTTP ヘッダーの不備 | 全ての画面遷移 |

**2.2 検出した脆弱性の説明**
**2.2.1 セッションフィクセーション**
**(1) 脆弱性の内容**
Mサイトでは form 内の hidden フィールドである sessionID の値だけでセッション管理を実施していた。しかし、表B のいずれの画面遷移においても、HTTP レスポンス中のsessionID の値が同一であった。

**表B セッションフィクセーション脆弱性の確認**
| 画面遷移 | HTTP レスポンス中の sessionID |
| :--- | :--- |
| Web ブラウザに直接 URL を入力して、画面01を表示したとき | `<input type="hidden" id="sessionID" name="sessionID" value="764b2ac2-0452-49e4-92a7-0914fa005011">` |
| 画面遷移(ア) | `<input type="hidden" id="sessionID" name="sessionID" value="764b2ac2-0452-49e4-92a7-0914fa005011">` |
| 画面遷移(イ) | `<input type="hidden" id="sessionID" name="sessionID" value="764b2ac2-0452-49e4-92a7-0914fa005011">` |
| 画面遷移(エ) | `<input type="hidden" id="sessionID" name="sessionID" value="764b2ac2-0452-49e4-92a7-0914fa005011">` |

攻撃者が図Aの手順でこの脆弱性を悪用すると、Mサイトに不正にログインすることができる。

**図A セッションフィクセーション脆弱性を悪用して不正ログインする手順**

  - **手順1:** 求人企業の登録メールアドレスを、何らかの方法で入手する。
  - **手順2:** URL" <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">b</span> "にアクセスして、sessionID を入手する。
  - **手順3:** 次の二つの要素を含む HTML を作成する。
      - 手順2で入手した sessionID を記述したフォーム
      - 当該HTML が Web ブラウザに読み込まれた直後に、上記のフォームをURL" <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">b</span> "にPOST メソッドで送信するスクリプト
  - **手順4:** 手順3で作成したHTMLを、罠サイトに置く。
  - **手順5:** 手順4のHTML へのリンクを含むメールを作成し、手順1で入手したメールアドレスに送信する。
  - **手順6:** 手順5のメールがメール受信者に届き、罠サイトにアクセスするのを待つ。
  - **手順7:** 罠サイトへのアクセスを検知後、 <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">c</span> が完了することを期待して数分間待ち、手順2で入手した sessionID を指定した状態で、URL" <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">b</span> "にアクセスする。

攻撃者が、セッションフィクセーション脆弱性を悪用して不正ログインに成功し、画面02で応募者確認ボタンをクリックして、当該企業の求人に応募した求職者の求職者属性情報と求職情報を閲覧できる。また、同じ画面 02で問合せ確認ボタンをクリックして、当該企業に問合せを行った求職者の求職者属性情報と問合せ内容を閲覧できる。

**(2) 脆弱性の修正方法**
<span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">a</span> の画面遷移の際に実行されるコードにおいて、 <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">d</span> することを推奨する。

**2.2.2 メールヘッダーインジェクション**
この脆弱性は、メール(あ)について検出された。なお、メール(い)では、この脆弱性は検出されなかった。
**(1) 脆弱性の内容**
図Bの手順で操作を行ったところ、メール(あ)が`abc@example.com` だけに送信され、本来の宛先である変更前のメールアドレスには送信されなかった。`abc@example.com` に送信されたメール(あ)の内容を表Cに示す。

**図B メールヘッダーインジェクション脆弱性を検出した手順**

  - **手順1:** 画面09の会社名に図Cの検査文字列を入力して変更ボタンをクリックする。
  - **手順2:** 画面11でOKボタンをクリックする。
  - **手順3:** 画面03でプロパティ変更ボタンをクリックして、再度、画面09を表示する。
  - **手順4:** 画面09でメールアドレスに`xyz@example.com` を入力して変更ボタンをクリックする。

**図C メールヘッダーインジェクションの検査文字列**

```
●●株式会社%0D%0ATo: abc@example.com%0D%0A%0D%0A
```

**表C メール(あ)の内容**
*注) `<本来の宛先>`には、変更前のメールアドレスが入っていた。*
| 位置 | 内容 |
| :--- | :--- |
| メール(あ)のヘッダー部の末尾 | `Subject: ●●株式会社 To:abc@example.com` |
| メール(あ)のボディ部の冒頭 | `様のメールアドレス変更のお知らせ To: <本来の宛先>` |

攻撃者がこの脆弱性を悪用するには、求人企業としてMサイトにログインする必要がある。求人企業としての登録には審査が必要であり、この脆弱性だけを利用して攻撃が行われるおそれは小さい。

**(2) 脆弱性の修正方法**
(省略)

**2.2.3 HTTP ヘッダーの不備**
**(1) 脆弱性の内容**
表DのHTTP ヘッダーは、出力するよう推奨されているが、いずれの画面遷移の HTTP レスポンスにおいても出力されなかった。

**表D 出力されなかった HTTP ヘッダー**
| HTTP ヘッダー名 | 設定した場合の主な効果 |
| :--- | :--- |
| Content-Security-Policy | Web ブラウザが実行可能なスクリプトの有効なソースとなるドメインを、Mサイトで必要なものだけに限定することができる。 |
| Strict-Transport-Security | <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">e</span> |
| X-Content-Type-Options | <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">f</span> |

これらの HTTP ヘッダーを設定することで他の脆弱性による被害を軽減することができる。
**(2) 脆弱性の修正方法**
(省略)

**3章 プラットフォームの診断結果**
**3.1 検出した脆弱性の概要**
検出した脆弱性は、表Eのとおりである。

**表E 検出したプラットフォームの脆弱性の一覧**
| 項番 | 重要度 | 脆弱性の種類 |
| :--- | :--- | :--- |
| 1 | (省略) | TLS 1.1が利用可能 |
| 2 | (省略) | HTTP サーバのバージョンの露出 |

**3.2 検出した脆弱性の説明**
**3.2.1 TLS 1.1が利用可能**
(省略)
**3.2.2 HTTP サーバのバージョンの露出**
HTTP レスポンスのヘッダーに、HTTP サーバのバージョンが出力されている。
(省略)

**4章 総合評価**
**4.1 想定される攻撃と被害**
攻撃者が、セッションフィクセーション脆弱性を悪用するだけでも求職者属性情報を窃取することができるが、図Dの順序で攻撃をした場合、不審なメールが求人企業に届かないので、攻撃に気付かれることなく、WebAPI を悪用して、より多くの求職者属性情報を窃取することができる。

**図D より多くの求職者属性情報の窃取につながる攻撃**

1.  図Aの手順で、Mサイトに不正にログインする。ただし、図Aの手順1で入手するメールアドレスは、WebAPI の利用権限をもつ求人企業のものである。
2.  <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">g</span>
3.  画面09で、メールアドレスに攻撃者のメールアドレスを入力して、変更ボタンをクリックする。
4.  別の端末から、画面01でPW 再設定ボタンをクリックし、(1)で不正にログインした利用者IDに対する一連のパスワード再設定処理を行う。
5.  再設定後のパスワードでログインする。
6.  <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">h</span>
7.  WebAPI の機能を利用して、多数の求職者属性情報を窃取する。
    (省略)

**5章 参考意見**
本章は、弊社の知見に基づく参考意見である。
**5.1 Mサイトの仕様についての意見**
今回の診断の過程で、Mサイトの仕様の一部を把握することができた。弊社が把握できた範囲内でも、Mサイトの仕様には幾つかの問題点があり、表Aと表Eの脆弱性を修正したとしても、インターネットからの攻撃によって被害が発生するおそれがある。
**5.1.1 WebAPI の仕様の改善**
WebAPI に関して、仕様の改善の方針案と改善すべき理由を表Fに示す。改善によって、攻撃による被害を未然に防止すること、又は被害を軽減することができる。

**表F WebAPI の仕様の改善の方針案**
| 項番 | 仕様の改善の方針案 | 改善すべき理由 |
| :--- | :--- | :--- |
| 1 | <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">i</span> | <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">j</span> |

**5.1.2 Web アプリケーションプログラムの求職者向け機能の仕様の改善**
(省略)
**5.1.3 Web アプリケーションプログラムの求人企業向け機能の仕様の改善**
Web アプリケーションプログラムの求人企業向け機能に関して、仕様の改善の方針案と改善すべき理由を表Gに示す。改善によって、攻撃による被害を未然に防止すること、又は被害を軽減することができる。

**表G Web アプリケーションプログラムの求人企業向け機能の仕様の改善の方針案**
| 項番 | 仕様の改善の方針案 | 改善すべき理由 |
| :--- | :--- | :--- |
| 1 | <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">k</span> | <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">l</span> |

(省略)

B社は、M社に診断報告書を提出し、セキュリティ診断を完了した。

-----

### 設問1

図4中の2章について答えよ。
(1) 表A中及び2.2.1(2)中の <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">a</span> に入れる適切な記号を、図3中の画面遷移の記号(ア)~(ナ)から選び、答えよ。
(2) 図A中の <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">b</span> に入れる適切なURLを、表1から選び答えよ。
(3) 図A中の <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">c</span> に入れる適切な操作を答えよ。
(4) 2.2.1(2) 中の <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">d</span> に入れる適切な修正方法を具体的に答えよ。
(5) 表D中の <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">e</span> 、 <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">f</span> に入れる適切な効果を答えよ。

### 設問2

図4中の4章にある図D中の <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">g</span> 、 <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">h</span> に入れる攻撃手順を答えよ。

### 設問3

あなたがこの診断を担当したとして、図4中の5章の表F中の <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">i</span> 、 <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">j</span> 及び表G中の <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">k</span> 、 <span style="display:inline-block; border: 1px solid black; padding: 0 10px; text-align: center;">l</span> に記述する内容を答えよ。なお、複数の改善の方針案がある場合は、被害を防ぐ効果が最も高いものを答えよ。

